<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星空告白 | 精准摘星版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0d0522, #1d0b4d, #37187e);
            color: #fff;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background: rgba(15, 7, 32, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.7);
            overflow: hidden;
            position: relative;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 15px 0;
        }
        
        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 5px;
            background: linear-gradient(to right, #ff7eb3, #ff758c, #ff7eb3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 15px rgba(255, 117, 140, 0.4);
        }
        
        .header p {
            color: #c0a9ff;
            font-size: 1rem;
        }
        
        .content {
            position: relative;
            min-height: 400px;
            margin: 15px 0;
        }
        
        .scene {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.8s ease;
            pointer-events: none;
        }
        
        .scene.active {
            opacity: 1;
            pointer-events: all;
            z-index: 10;
        }
        
        .question {
            text-align: center;
            margin-bottom: 15px;
            width: 100%;
        }
        
        .question h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #ffd7e9;
            text-shadow: 0 0 10px rgba(255, 215, 233, 0.3);
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 130px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .btn-yes {
            background: linear-gradient(to right, #ff6b8b, #ff8e53);
            color: white;
        }
        
        .btn-no {
            background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white;
        }
        
        .btn-accept {
            background: linear-gradient(to right, #28a745, #20c997);
            color: white;
        }
        
        .btn-decline {
            background: linear-gradient(to right, #6c757d, #5a6268);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        
        .btn:active {
            transform: translateY(2px);
        }
        
        .animation-container {
            width: 100%;
            height: 380px;
            position: relative;
            margin: 10px 0;
            overflow: hidden;
            border-radius: 15px;
            background: rgba(8, 3, 22, 0.7);
            border: 2px solid rgba(100, 75, 200, 0.3);
            box-shadow: inset 0 0 20px rgba(100, 75, 200, 0.2), 
                        0 0 20px rgba(0, 0, 0, 0.4);
        }
        
        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, #07021a, #16073a);
        }
        
        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }
        
        /* 优化的小人结构 */
        .stickman {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            height: 140px;
            width: 50px;
        }
        
        .stickman .head {
            position: absolute;
            width: 28px;
            height: 28px;
            background: white;
            border-radius: 50%;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            z-index: 15;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }
        
        .stickman .body {
            position: absolute;
            width: 5px;
            height: 60px;
            background: white;
            top: 28px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            border-radius: 4px;
        }
        
        .stickman .arm {
            position: absolute;
            width: 5px;
            height: 45px;
            background: white;
            top: 33px;
            transform-origin: top center;
            z-index: 12;
            border-radius: 4px;
        }
        
        .stickman .arm-left {
            left: 50%;
            transform: translateX(-50%) rotate(20deg);
        }
        
        .stickman .arm-right {
            left: 50%;
            transform: translateX(-50%) rotate(-20deg);
        }
        
        .stickman .leg {
            position: absolute;
            width: 5px;
            height: 50px;
            background: white;
            top: 88px;
            transform-origin: top center;
            z-index: 11;
            border-radius: 4px;
        }
        
        .stickman .leg-left {
            left: 50%;
            transform: translateX(-50%) rotate(15deg);
        }
        
        .stickman .leg-right {
            left: 50%;
            transform: translateX(-50%) rotate(-15deg);
        }
        
        /* 告白容器和滚动样式 */
        .confession-container {
            width: 100%;
            height: 350px;
            margin: 15px 0;
            position: relative;
        }
        
        .confession-scroll {
            width: 100%;
            height: 100%;
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 107, 139, 0.5) rgba(255, 255, 255, 0.1);
        }
        
        .confession-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .confession-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .confession-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 139, 0.5);
            border-radius: 3px;
        }
        
        .confession-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 107, 139, 0.7);
        }
        
        .confession-content {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 25px 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease;
        }
        
        .confession-content h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #ff9ec0;
            text-shadow: 0 0 10px rgba(255, 158, 192, 0.5);
            text-align: center;
        }
        
        .confession-content p {
            font-size: 1.1rem;
            line-height: 1.7;
            color: #e0d6ff;
            margin-bottom: 18px;
            text-shadow: 0 0 8px rgba(255, 158, 192, 0.2);
            text-align: justify;
        }
        
        .confession-content .highlight {
            color: #e0d6ff;
            text-shadow: 0 0 8px rgba(255, 158, 192, 0.2);
            font-weight: 600;
        }
        
        .heart {
            color: #ff6b8b;
            font-size: 2.5rem;
            margin: 0 5px;
            animation: heartbeat 1.2s infinite;
            vertical-align: middle;
        }
        
        .progress {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin: 20px 0;
        }
        
        .step {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transition: all 0.5s ease;
            box-shadow: 0 0 8px rgba(255, 107, 139, 0.3);
        }
        
        .step.active {
            background: #ff6b8b;
            transform: scale(1.4);
            box-shadow: 0 0 12px rgba(255, 107, 139, 0.8);
        }
        
        @keyframes twinkle {
            0%, 100% { 
                opacity: 0.3; 
                transform: scale(1);
            }
            50% { 
                opacity: 1; 
                transform: scale(1.1);
                box-shadow: 0 0 10px white;
            }
        }
        
        @keyframes heartbeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .stars-collected {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 25px 0;
        }
        
        .star-item {
            width: 45px;
            height: 45px;
            background: radial-gradient(circle at 30% 30%, #ffffff, #ffeb3b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            box-shadow: 0 0 20px rgba(255, 235, 59, 0.7);
            opacity: 0;
            transform: scale(0);
            animation: starAppear 1s forwards;
        }
        
        @keyframes starAppear {
            to {
                opacity: 1;
                transform: scale(1) rotate(360deg);
            }
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: #a090d0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 15px;
        }
        
        .message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            color: #ff6b8b;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }
        
        .message.show {
            opacity: 1;
        }
        
        .star-object, .moon-object {
            position: absolute;
            top: 30px;
            right: 25px;
            font-size: 40px;
            opacity: 1;
            z-index: 20;
            text-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
            animation: float 4s infinite ease-in-out;
            transition: all 0.3s ease;
        }
        
        .moon-object {
            font-size: 50px;
        }
        
        /* 魔术问题场景的特殊样式 */
        .magic-question {
            text-align: center;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            padding: 30px 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease;
        }
        
        .magic-question h2 {
            font-size: 2rem;
            margin-bottom: 25px;
            color: #ff9ec0;
            text-shadow: 0 0 10px rgba(255, 158, 192, 0.5);
        }
        
        .magic-question p {
            font-size: 1.4rem;
            line-height: 1.8;
            color: #e0d6ff;
            margin-bottom: 20px;
            text-shadow: 0 0 8px rgba(255, 158, 192, 0.4);
        }
        
        .magic-icon {
            font-size: 3rem;
            color: #ffeb3b;
            margin: 20px 0;
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                text-shadow: 0 0 20px rgba(255, 235, 59, 0.8);
            }
            50% { 
                transform: scale(1.1) rotate(5deg);
                text-shadow: 0 0 30px rgba(255, 235, 59, 0.9);
            }
        }
        
        /* 响应式设计 */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
                max-width: 100%;
                margin: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .question h2 {
                font-size: 1.5rem;
            }
            
            .btn {
                padding: 10px 25px;
                min-width: 110px;
                font-size: 1rem;
            }
            
            .animation-container {
                height: 280px;
            }
            
            .confession-container {
                height: 300px;
            }
            
            .confession-content {
                padding: 20px 15px;
            }
            
            .confession-content h2 {
                font-size: 1.6rem;
            }
            
            .confession-content p {
                font-size: 1rem;
                line-height: 1.6;
                margin-bottom: 15px;
            }
            
            .star-object, .moon-object {
                right: 20px;
                font-size: 35px;
            }
            
            .magic-question h2 {
                font-size: 1.6rem;
            }
            
            .magic-question p {
                font-size: 1.2rem;
            }
            
            .final-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .final-buttons .btn {
                width: 100%;
                max-width: 200px;
            }
        }
        
        @media (max-width: 360px) {
            .container {
                margin: 5px;
                padding: 12px;
            }
            
            .confession-container {
                height: 280px;
            }
            
            .confession-content {
                padding: 18px 12px;
            }
            
            .confession-content h2 {
                font-size: 1.4rem;
            }
            
            .confession-content p {
                font-size: 0.95rem;
            }
        }
        
        @keyframes float {
            0%, 100% { 
                transform: translateY(0) rotate(0deg); 
            }
            50% { 
                transform: translateY(-15px) rotate(5deg); 
            }
        }
        
        .status-text {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 1.5rem;
            color: #ffd7e9;
            text-shadow: 0 0 10px rgba(255, 215, 233, 0.7);
            z-index: 25;
        }
        
        .action-indicator {
            position: absolute;
            top: 60px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 1.2rem;
            color: #ffb6c1;
            z-index: 25;
            opacity: 0.9;
        }
        
        .highlight {
            color: #ffeb3b;
            text-shadow: 0 0 15px rgba(255, 235, 59, 0.9);
            font-weight: bold;
            padding: 0 3px;
        }
        
        /* 完美的摘星动画序列 */
        @keyframes perfect-jump {
            0% { 
                transform: translateX(-50%) translateY(0); 
            }
            50% { 
                transform: translateX(-50%) translateY(-120px); 
            }
            100% { 
                transform: translateX(-50%) translateY(0); 
            }
        }
        
        @keyframes reach-and-grab {
            0% { 
                transform: translateX(-50%) rotate(-20deg); 
            }
            40% { 
                transform: translateX(-50%) rotate(-140deg); 
            }
            60% { 
                transform: translateX(-50%) rotate(-140deg); 
            }
            100% { 
                transform: translateX(-50%) rotate(20deg); 
            }
        }
        
        @keyframes object-grabbed {
            0% { 
                top: 60px;
                right: 80px;
                transform: scale(1);
                opacity: 1;
            }
            30% { 
                top: 35px;
                right: 30px;
                transform: scale(0.9);
                opacity: 1;
            }
            60% { 
                top: 20px;
                right: 25px;
                transform: scale(0.8);
                opacity: 1;
            }
            100% { 
                top: 15px;
                left: 50%;
                right: auto;
                transform: translateX(-50%) scale(0.8);
                opacity: 1;
            }
        }
        
        @keyframes holding-celebration {
            0%, 100% { 
                transform: translateX(-50%) translateY(0); 
            }
            50% { 
                transform: translateX(-50%) translateY(-25px); 
            }
        }
        
        @keyframes arm-to-holding {
            0% { 
                transform: translateX(-50%) rotate(20deg); 
            }
            100% { 
                transform: translateX(-50%) rotate(50deg) translateY(-5px); 
            }
        }
        
        @keyframes object-in-hands {
            0%, 100% { 
                transform: translateX(-50%) scale(0.8) translateY(0px); 
            }
            50% { 
                transform: translateX(-50%) scale(0.85) translateY(-3px); 
            }
        }
        
        /* 粒子效果 */
        .particle {
            position: absolute;
            background: #ffeb3b;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }
        
        @keyframes particle-explosion {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx), var(--ty)) scale(0);
                opacity: 0;
            }
        }
        
        /* 结果场景样式 */
        .result-message {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 1s ease;
        }
        
        .result-message h2 {
            font-size: 2rem;
            margin-bottom: 15px;
            color: #ff9ec0;
            text-shadow: 0 0 10px rgba(255, 158, 192, 0.5);
        }
        
        .result-scroll {
            max-height: 250px;
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 107, 139, 0.5) rgba(255, 255, 255, 0.1);
        }
        
        .result-scroll::-webkit-scrollbar {
            width: 6px;
        }
        
        .result-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .result-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 139, 0.5);
            border-radius: 3px;
        }
        
        .result-content p {
            font-size: 1.2rem;
            line-height: 1.7;
            color: #e0d6ff;
            margin-bottom: 15px;
            text-align: justify;
        }
        
        .final-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>星空告白</h1>
            <p>为你摘下星辰，只为换你一笑</p>
        </div>
        
        <div class="progress">
            <div class="step active"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
            <div class="step"></div>
        </div>
        
        <div class="content">
            <!-- 场景1：星星问题 -->
            <div class="scene active" id="scene1">
                <div class="question">
                    <h2>第一个问题</h2>
                    <p>请问你想要天上的星星吗？</p>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-yes" onclick="answerQuestion(true, 1)">是的，我想要</button>
                    <button class="btn btn-no" onclick="answerQuestion(false, 1)">不，谢谢</button>
                </div>
            </div>
            
            <!-- 场景2：摘星星动画 -->
            <div class="scene" id="scene2">
                <div class="status-text">摘星星中...</div>
                <div class="animation-container">
                    <div class="sky" id="sky1"></div>
                    <div class="star-object" id="star1">⭐</div>
                    <div class="stickman" id="stickman1">
                        <div class="head"></div>
                        <div class="body"></div>
                        <div class="arm arm-left"></div>
                        <div class="arm arm-right"></div>
                        <div class="leg leg-left"></div>
                        <div class="leg leg-right"></div>
                    </div>
                </div>
                <div class="action-indicator">让我为你摘下那颗最亮的星星！</div>
            </div>
            
            <!-- 场景3：月亮问题 -->
            <div class="scene" id="scene3">
                <div class="question">
                    <h2>第二个问题</h2>
                    <p>请问你想要天上的月亮吗？</p>
                </div>
                
                <div class="stars-collected">
                    <div class="star-item">⭐</div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-yes" onclick="answerQuestion(true, 2)">是的，我想要</button>
                    <button class="btn btn-no" onclick="answerQuestion(false, 2)">不，谢谢</button>
                </div>
            </div>
            
            <!-- 场景4：摘月亮动画 -->
            <div class="scene" id="scene4">
                <div class="status-text">摘月亮中...</div>
                <div class="animation-container">
                    <div class="sky" id="sky2"></div>
                    <div class="moon-object" id="moon1">🌙</div>
                    <div class="stickman" id="stickman2">
                        <div class="head"></div>
                        <div class="body"></div>
                        <div class="arm arm-left"></div>
                        <div class="arm arm-right"></div>
                        <div class="leg leg-left"></div>
                        <div class="leg leg-right"></div>
                    </div>
                </div>
                <div class="action-indicator">让我为你摘下那轮皎洁的明月！</div>
            </div>
            
            <!-- 新增场景5：魔术问题 -->
            <div class="scene" id="scene5">
                <div class="magic-question">
                    <h2>魔术表演结束</h2>
                    <p>摘星星和月亮的魔术已经表演给你了</p>
                    <p>能不能再借你几分钟的时间</p>
                    <p>看看我想对你说的话？</p>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-yes" onclick="answerMagicQuestion(true)">好的</button>
                    <button class="btn btn-no" onclick="answerMagicQuestion(false)">抱歉，没时间</button>
                </div>
            </div>
            
            <!-- 场景6：告白 -->
            <div class="scene" id="scene6">
                <div class="confession-container">
                    <div class="confession-scroll">
                        <div class="confession-content">
                            <h2>To Nichole:</h2>
                            <p>首先我要先谢谢你能够花时间看我的表演哈哈哈哈(虽然只有几秒而已）。不懂你看到这里的时候我有没有在你的身边（我会害羞哈哈哈）。</p>
                            
                            <p>Erm 下次不懂还有没有机会见面...?所以就先写一些自己的心里话啦。</p>
                            
                            <p>讲真的很谢谢你这段时间能够陪我聊聊天，开开玩笑哈哈哈，可以讲真的是在我心情低落的时候可以让我找到一些快乐和安慰。</p>
                            
                            <p>虽然我们见面的次数很少很少，但是自从我离开纳闽一段时间后我发现我不想和你分开，我原以为我们还有至少10个月的时间可以继续相处，但是现在计划赶不上变化哈哈哈。</p>
                            
                            <p>我回来的那段时间真的发生了很多事情很不好受，但是就像我之前和你说过的一样，<span class="highlight">你的出现让我眼中的世界变得多姿多彩，让我原本暗淡无光的生活变得五彩斑斓</span>，在我因为生活疲惫不堪时，会因为你的存在觉得人生还很美好。</p>
                            
                            <p>对我来说，<span class="highlight">今年最幸运的事情就是遇到了你</span>，你的出现像明媚的曙光，让我对平淡的生活重新有了期待，期待每个见面的机会。</p>
                            
                            <p><span class="highlight">我真的很喜欢你，想一直陪伴你</span>，虽然同时我也懂不是所有相遇都有结果，但我觉得你是属于那种，光是遇见已经是上上签的了。</p>
                            
                            <p>我看到你的第一眼就对你有了莫名的好感，这种心灵涌上的似曾相识的亲切感为唯独你才给的了我的感觉，就像我梦中的虚影，在见到你的那一刻突然有了实体。</p>
                            
                            <p><span class="highlight">你不是我权衡利弊后的选择，而是我怦然心动后明知不可而为之的坚定。</span></p>
                            
                            <p>当然，我也不想用喜欢或爱去绑架一个人，所以不要有压力，这些话是在我思考良久后决定对你表达我对你的告白。</p>
                            
                            <p>看到这里，如果你觉得感到不适或恶心的话你可以选择退出或当面拒绝我哈哈哈，我已经做好准备接受一切了哈哈哈哈。</p>
                            
                            <p>在这之后你可以给我一些反馈和回复，当然也可以保持沉默当作没有事情发生哈哈哈哈，我觉得结果可能已经没有那么重要了，到最后我不管怎样我都希望你未来可以越来越好，享受生活，快乐做自己！</p>
                            
                            <p style="text-align: right; margin-top: 30px; font-style: italic; color: #ff9ec0;">Jonas</p>
                        </div>
                    </div>
                </div>
                
                <div class="final-buttons">
                    <button class="btn btn-accept" onclick="handleResponse(true)">
                        <i class="fas fa-heart"></i> 我接受
                    </button>
                    <button class="btn btn-decline" onclick="handleResponse(false)">
                        <i class="fas fa-times"></i> 我拒绝
                    </button>
                </div>
            </div>
            
            <!-- 场景7：结果 -->
            <div class="scene" id="scene7">
                <div class="result-message" id="resultMessage">
                    <!-- 动态内容 -->
                </div>
                
                <button class="btn btn-yes" style="margin-top: 20px; padding: 12px 35px;" onclick="restartStory()">
                    <i class="fas fa-redo"></i> 再看一次
                </button>
            </div>
        </div>
        
        <div class="footer">
            用心制作 · 只为你一人 | 2024
        </div>
        
        <div class="message" id="message">请选择"是的，我想要"来继续故事</div>
    </div>

    <script>
        // 全局变量
        let currentScene = 1;
        const collectedItems = [];
        
        // 初始化星空背景
        function createStars(skyId, count = 150) {
            const sky = document.getElementById(skyId);
            if (!sky) return;
            
            // 清空现有星星
            sky.innerHTML = '';
            
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                
                // 随机大小和位置
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                
                sky.appendChild(star);
            }
        }
        
        // 创建庆祝粒子效果
        function createParticles(centerX, centerY, count = 25) {
            const container = document.querySelector('.animation-container');
            if (!container) return;
            
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // 随机属性
                const size = Math.random() * 8 + 3;
                const colors = ['#ffeb3b', '#ff6b8b', '#4facfe', '#00f2fe', '#ffffff'];
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.background = color;
                particle.style.position = 'absolute';
                particle.style.left = `${centerX}px`;
                particle.style.top = `${centerY}px`;
                particle.style.zIndex = '30';
                
                // 随机方向和距离
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * 150 + 50;
                const tx = Math.cos(angle) * distance;
                const ty = Math.sin(angle) * distance;
                
                particle.style.setProperty('--tx', `${tx}px`);
                particle.style.setProperty('--ty', `${ty}px`);
                
                // 动画
                particle.style.animation = `particle-explosion ${Math.random() * 1.5 + 1}s ease-out forwards`;
                
                container.appendChild(particle);
                
                // 清理
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                }, 2500);
            }
        }
        
        // 场景切换函数
        function switchScene(sceneNumber) {
            console.log(`切换到场景 ${sceneNumber}`);
            currentScene = sceneNumber;
            
            // 隐藏所有场景
            document.querySelectorAll('.scene').forEach(scene => {
                scene.classList.remove('active');
            });
            
            // 显示目标场景
            const targetScene = document.getElementById(`scene${sceneNumber}`);
            if (targetScene) {
                targetScene.classList.add('active');
            }
            
            // 更新进度指示器
            document.querySelectorAll('.step').forEach((step, index) => {
                step.classList.toggle('active', index < sceneNumber);
            });
            
            // 场景特定初始化
            if (sceneNumber === 2) {
                createStars('sky1', 150);
                setTimeout(() => {
                    startPerfectPickingAnimation(1, 'star1', '⭐');
                }, 800);
            } else if (sceneNumber === 4) {
                createStars('sky2', 150);
                setTimeout(() => {
                    startPerfectPickingAnimation(2, 'moon1', '🌙');
                }, 800);
            }
        }
        
        // 完美简洁的摘取动画函数
        function startPerfectPickingAnimation(stickmanId, objectId, itemSymbol) {
            console.log(`开始完美摘取动画: ${objectId}`);
            
            const stickman = document.getElementById(`stickman${stickmanId}`);
            const object = document.getElementById(objectId);
            const rightArm = stickman?.querySelector('.arm-right');
            const leftArm = stickman?.querySelector('.arm-left');
            const head = stickman?.querySelector('.head');
            
            if (!stickman || !object || !rightArm || !leftArm) {
                console.error('找不到必要的动画元素');
                return;
            }
            
            // 重置所有状态
            resetStickmanState(stickman);
            resetObjectState(object);
            
            console.log('开始完美简洁动画序列...');
            
            // 动画序列 - 极简版本
            const animationSequence = async () => {
                // 第1步：小人起跳并伸手触摸 (2.0秒)
                console.log('步骤1: 小人起跳伸手触摸');
                
                // 开始跳跃
                stickman.style.animation = 'perfect-jump 2.0s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                
                // 延迟400ms开始伸手，让动作更自然
                setTimeout(() => {
                    rightArm.style.transition = 'transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
                    rightArm.style.transform = 'translateX(-50%) rotate(-110deg)';  // 调整角度让手臂精准触及星星/月亮
                }, 400);
                
                // 等待1.2秒 - 手臂触摸到星星/月亮的瞬间
                await delay(1200);
                
                // 第2步：星星/月亮被触摸，立即跟随小人
                console.log('步骤2: 星星/月亮跟随小人');
                
                // 将星星/月亮移动到小人内部，让它跟随小人一起移动
                stickman.appendChild(object);
                
                // 立即定位到右手附近
                object.style.position = 'absolute';
                object.style.top = '25px';  // 在右手附近
                object.style.left = '65%';  // 稍微偏右
                object.style.right = 'auto';
                object.style.transform = 'scale(0.9)';
                object.style.zIndex = '25';
                object.style.animation = 'none';
                object.style.transition = 'all 0.6s ease-out';
                
                // 第3步：在落地过程中切换到双手抱姿势
                await delay(400); // 等待小人开始落下
                
                console.log('步骤3: 切换到双手抱姿势');
                
                // 同时进行：手臂调整 + 星星/月亮移动到怀中
                // 右手臂回收
                rightArm.style.transition = 'transform 0.4s ease-out';
                rightArm.style.transform = 'translateX(-50%) rotate(-50deg) translateY(-5px)';
                
                // 左手臂伸出抱姿势
                leftArm.style.transition = 'transform 0.4s ease-out';
                leftArm.style.transform = 'translateX(-50%) rotate(50deg) translateY(-5px)';
                
                // 头部轻微上抬
                head.style.transition = 'transform 0.4s ease-out';
                head.style.transform = 'translateX(-50%) translateY(-5px)';
                
                // 星星/月亮移动到怀中央
                object.style.top = '20px';
                object.style.left = '50%';
                object.style.transform = 'translateX(-50%) scale(0.8)';
                
                // 等待手臂调整完成
                await delay(400);
                
                // 第4步：落地后庆祝
                await delay(400); // 等待完全落地
                
                console.log('步骤4: 庆祝');
                
                // 添加轻微浮动效果
                object.style.animation = 'object-in-hands 2s ease-in-out infinite';
                
                // 创建庆祝粒子效果
                const containerRect = document.querySelector('.animation-container').getBoundingClientRect();
                const stickmanRect = stickman.getBoundingClientRect();
                const centerX = stickmanRect.left - containerRect.left + stickmanRect.width / 2;
                const centerY = stickmanRect.top - containerRect.top + 80;
                
                createParticles(centerX, centerY, 20);
                
                // 庆祝跳跃动画 - 小人和物体一起跳跃
                stickman.style.animation = 'holding-celebration 0.6s ease-in-out 2';
                
                // 记录收集的物品
                if (!collectedItems.includes(itemSymbol)) {
                    collectedItems.push(itemSymbol);
                }
                
                console.log(`${itemSymbol} 摘取完成！`);
                
                // 等待庆祝完成后切换场景
                await delay(1500);
                
                if (stickmanId === 1) {
                    console.log('摘星完成，切换到月亮问题场景');
                    switchScene(3);
                } else {
                    console.log('摘月完成，切换到魔术问题场景');
                    switchScene(5);
                }
            };
            
            // 启动动画序列
            animationSequence().catch(error => {
                console.error('动画序列执行出错:', error);
            });
        }
        
        // 辅助函数：延迟执行
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // 重置小人状态
        function resetStickmanState(stickman) {
            // 重置小人整体
            stickman.style.transform = 'translateX(-50%)';
            stickman.style.animation = 'none';
            stickman.style.transition = 'none';
            
            // 重置手臂
            const leftArm = stickman.querySelector('.arm-left');
            const rightArm = stickman.querySelector('.arm-right');
            if (leftArm) {
                leftArm.style.animation = 'none';
                leftArm.style.transition = 'none';
                leftArm.style.transform = 'translateX(-50%) rotate(20deg)';
            }
            if (rightArm) {
                rightArm.style.animation = 'none';
                rightArm.style.transition = 'none';
                rightArm.style.transform = 'translateX(-50%) rotate(-20deg)';
            }
            
            // 重置头部
            const head = stickman.querySelector('.head');
            if (head) {
                head.style.transition = 'none';
                head.style.transform = 'translateX(-50%)';
            }
        }
        
        // 重置物体状态
        function resetObjectState(object) {
            // 确保物体在正确的父容器中
            const animationContainer = object.closest('.animation-container');
            if (animationContainer && object.parentNode !== animationContainer) {
                animationContainer.appendChild(object);
            }
            
            // 重置物体样式 - 调整到手臂可以精准触及的位置
            object.style.position = 'absolute';
            object.style.top = '30px';
            object.style.right = '25px';
            object.style.left = 'auto';
            object.style.transform = 'scale(1)';
            object.style.opacity = '1';
            object.style.transition = 'none';
            object.style.animation = 'float 4s infinite ease-in-out';
            object.style.zIndex = '20';
        }
        
        // 问题回答处理
        function answerQuestion(answer, questionNumber) {
            console.log(`回答问题 ${questionNumber}: ${answer ? '是' : '否'}`);
            
            if (answer) {
                // 正确答案，继续故事
                const nextScene = questionNumber === 1 ? 2 : 4;
                switchScene(nextScene);
            } else {
                // 显示提示消息
                showMessage("请选择'是的，我想要'来继续故事");
            }
        }
        
        // 新增：处理魔术问题的回答
        function answerMagicQuestion(answer) {
            console.log(`回答魔术问题: ${answer ? '是' : '否'}`);
            
            if (answer) {
                // 同意继续，切换到告白场景
                switchScene(6);
            } else {
                // 显示提示消息
                showMessage("请选择'好的'来继续故事");
            }
        }
        
        // 显示消息提示
        function showMessage(text) {
            const message = document.getElementById('message');
            if (message) {
                message.textContent = text;
                message.classList.add('show');
                
                setTimeout(() => {
                    message.classList.remove('show');
                }, 2500);
            }
        }
        
        // 处理最终告白回应
        function handleResponse(accepted) {
            console.log(`告白回应: ${accepted ? '接受' : '拒绝'}`);
            
            const resultMessage = document.getElementById('resultMessage');
            if (!resultMessage) return;
            
            if (accepted) {
                resultMessage.className = 'result-message';
                resultMessage.innerHTML = `
                    <div class="result-scroll">
                        <div class="result-content">
                            <p>真的吗?这简直比种头奖还难相信哈哈哈。非常感谢你可以这么不嫌弃我哈哈哈哈。</p>
                            <p>未来的路还很长，但是不要担心，我会一直牵着你的手陪你一起走，我一直都会在，也会一直宠你哈哈哈。</p>
                            <p style="font-weight: 600; margin-top: 25px;">谢谢你，我的专属小美。最喜欢你了！</p>
                        </div>
                    </div>
                `;
            } else {
                resultMessage.className = 'result-message';
                resultMessage.innerHTML = `
                    <div class="result-scroll">
                        <div class="result-content">
                            <p>这是我意料之中的结果了，我本身也对自己没有抱有那么大的期望哈哈哈是我无能没本事，没有办法走进你的心里。</p>
                            <p>但是最后还是要谢谢你曾经的陪伴和对我的耐心，有你在我真的很开心。很遗憾，也很难忘，但我不会后悔。</p>
                            <p style="font-weight: 600; margin-top: 25px;">虽然未来的路我们不能同行，但是我还是希望你会越来越好，永远明媚，永远快乐，祝你平安！</p>
                        </div>
                    </div>
                `;
            }
            
            switchScene(7);
        }
        
        // 重新开始故事
        function restartStory() {
            console.log('重新开始故事');
            
            // 重置全局状态
            currentScene = 1;
            collectedItems.length = 0;
            
            // 重置所有动画对象的位置
            resetAllObjects();
            
            // 切换到第一个场景
            switchScene(1);
        }
        
        // 重置所有动画对象
        function resetAllObjects() {
            // 重置星星
            const star1 = document.getElementById('star1');
            if (star1) {
                const animationContainer = star1.closest('.animation-container') || document.querySelector('#scene2 .animation-container');
                if (animationContainer && star1.parentNode !== animationContainer) {
                    animationContainer.appendChild(star1);
                }
                resetObjectState(star1);
            }
            
            // 重置月亮
            const moon1 = document.getElementById('moon1');
            if (moon1) {
                const animationContainer = moon1.closest('.animation-container') || document.querySelector('#scene4 .animation-container');
                if (animationContainer && moon1.parentNode !== animationContainer) {
                    animationContainer.appendChild(moon1);
                }
                resetObjectState(moon1);
            }
            
            // 重置所有小人
            const stickman1 = document.getElementById('stickman1');
            const stickman2 = document.getElementById('stickman2');
            
            if (stickman1) resetStickmanState(stickman1);
            if (stickman2) resetStickmanState(stickman2);
        }
        
        // 页面加载完成后初始化
        window.addEventListener('load', function() {
            console.log('页面加载完成，初始化星空');
            createStars('sky1', 150);
            createStars('sky2', 150);
        });
        
        // 错误处理
        window.addEventListener('error', function(e) {
            console.error('发生错误:', e.error);
        });
    </script>
</body>
</html>